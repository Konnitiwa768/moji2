<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¢‘æ–‡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆhtml2canvas ä¿®æ­£ç‰ˆï¼‰</title>
  <style>
    @font-face { font-family:'Lakof'; src:url('out/ttf/lakof-regular.ttf') format('truetype'); }
    body { background: linear-gradient(145deg,#e8e2d0,#c2b59b); font-family:'Lakof',sans-serif; display:flex;flex-direction:column;align-items:center;padding:40px; }
    #insc-wrap { background: linear-gradient(to bottom,#fefefe,#dcd3c2); border:6px double #8c7a60; box-shadow:0 0 25px rgba(0,0,0,0.2); padding:30px;border-radius:20px; max-width:800px; margin-bottom:20px; position:relative;}
    #inscription { font-size:20px; line-height:1.7; color:#444; white-space:pre-wrap; text-shadow:1px 1px 0 #aaa, -1px -1px 0 #fff, 2px 2px 2px rgba(0,0,0,0.2); mix-blend-mode:multiply; }
    input,button { margin:5px;padding:8px;font-size:14px; }
    #status { margin-top:10px; font-family:sans-serif; }
  </style>
</head>
<body>

<h2>å¤ä»£ç¢‘æ–‡ï¼šAliceã®ç« ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç‰ˆï¼‰</h2>
<div id="insc-wrap">
  <div id="inscription">
Alice iz zelarbin suc zavonin te ikt to sel...ï¼ˆçœç•¥ï¼‰
  </div>
</div>

<div>
  <input id="username" placeholder="GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼å">
  <input id="repo" placeholder="ãƒªãƒã‚¸ãƒˆãƒªå">
  <input id="pat" placeholder="GitHub Personal Access Token">
  <input id="filename" value="inscription.png">
  <button id="uploadBtn">ç”Ÿæˆï¼‹ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
</div>
<div id="status"></div>

<!-- html2canvas CDN -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
document.getElementById('uploadBtn').addEventListener('click', async () => {
  const status = document.getElementById('status');
  status.innerText = "ğŸ“¸ ç”»åƒã‚’ç”Ÿæˆä¸­...";
  const wrap = document.getElementById('insc-wrap');
  const canvas = await html2canvas(wrap, { backgroundColor: null });
  
  canvas.toBlob(async blob => {
    const base64 = await new Promise(r => {
      const reader = new FileReader();
      reader.onload = () => r(reader.result.split(',')[1]);
      reader.readAsDataURL(blob);
    });

    const username = document.getElementById("username").value;
    const repo = document.getElementById("repo").value;
    const token = document.getElementById("pat").value;
    const filename = document.getElementById("filename").value;
    const url = `https://api.github.com/repos/${username}/${repo}/contents/images/${filename}`;

    const res = await fetch(url, {
      method: 'PUT',
      headers: {
        "Authorization": `token ${token}`,
        "Accept": "application/vnd.github.v3+json"
      },
      body: JSON.stringify({
        message: "Add inscription image",
        content: base64
      })
    });

    if (res.ok) {
      const data = await res.json();
      status.innerHTML = `âœ… æˆåŠŸï¼<br><a href="${data.content.html_url}" target="_blank">${data.content.path}</a>`;
    } else {
      const err = await res.json();
      status.innerHTML = `âŒ å¤±æ•—: ${res.status}<br>${err.message}`;
    }
  });
});
</script>
</body>
</html>
