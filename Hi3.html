<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å¤ä»£ç¢‘æ–‡ï¼šAliceã®ç« ï¼ˆå®Œå…¨ç‰ˆï¼‰</title>
  <style>
    /* è‡ªä½œãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ */
    @font-face {
      font-family: 'Lakof';
      src: url('out/ttf/lakof-regular.ttf') format('truetype');
    }
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      background: linear-gradient(145deg, #e8e2d0, #c2b59b);
      font-family: 'Lakof', sans-serif;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      padding-top: 40px;
    }
    h2 {
      font-family: sans-serif;
      color: #5c4a33;
      text-shadow: 1px 1px 0 #fff;
      margin-bottom: 20px;
    }
    #insc-wrap {
      background: linear-gradient(to bottom, #fefefe, #dcd3c2);
      border: 6px double #8c7a60;
      box-shadow: 0 0 25px rgba(0,0,0,0.2);
      border-radius: 20px;
      padding: 30px;
      max-width: 800px;
      width: 90%;
      position: relative;
    }
    #inscription {
      font-size: 20px;
      line-height: 1.7;
      color: #444;
      white-space: pre-wrap;
      text-shadow:
        1px 1px 0 #aaa,
       -1px -1px 0 #fff,
        2px 2px 2px rgba(0,0,0,0.2);
      mix-blend-mode: multiply;
    }
    .controls {
      margin-top: 20px;
      font-family: sans-serif;
    }
    .controls input {
      margin: 4px; padding: 6px;
      font-size: 14px;
    }
    .controls button {
      margin: 4px; padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    #status {
      margin-top: 12px;
      font-family: sans-serif;
      line-height: 1.4;
    }
  </style>
</head>
<body>

  <h2>å¤ä»£ç¢‘æ–‡ï¼šAliceã®ç« ï¼ˆå®Œå…¨ç‰ˆï¼‰</h2>

  <div id="insc-wrap">
    <div id="inscription">
Alice iz zelarbin suc zavonin te ikt to sel, amorrushmakonkta.  
a aing, zva iz zavonin te menar-bilb o'ardn mueed.  
lee ilagen sung chaikin illu.  
"ilagen sung chaikin illu-bilb iz mucioul" alis lethkta.  
leesuc Alice lithor-ing hilee-been von ser rinar hini gar hilee hillee mendokusee, paizellta (chenu suc oton, urdu lendy.)  
lee ir, pec-maik fadarl sar nal-felta thas madda futtuuta.  
Alice sar thas darl sar "doushau! doushau!" chikok" ginn okasi lethkna.  
(phichuzelna, hini natur to lethkta.)  
hini thas darl sar lar Chokki pokketchule zymile (Kaichudokei) to lye haa, pankik,  
Alice hya, ngo Chokki-pokket ork myzile fir iz nirank'a f'a fest zygylagyly darl vaga danaj lem-darl-thu-uuy vee ngl'ngl sar ya.  
hax oddee, Alice sung lee phica von ayayayay vee.  
donq hsin zelarna.  
darl-uuy, venneel, thaschule lappen Zudon ugi, cthuktuk lappen,  
Alice essi-iml olba, fest ush aan ikii bengeel ugi nenkta.
    </div>
  </div>

  <div class="controls">
    <input id="username" placeholder="GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼å">
    <input id="repo" placeholder="ãƒªãƒã‚¸ãƒˆãƒªåï¼ˆä¾‹: my-repoï¼‰">
    <input id="pat" placeholder="Personal Access Token">
    <input id="filename" value="inscription.png" placeholder="ãƒ•ã‚¡ã‚¤ãƒ«å">
    <button id="uploadBtn">ç”»åƒç”Ÿæˆï¼‹ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
    <div id="status"></div>
  </div>

  <!-- html2canvas ã®èª­ã¿è¾¼ã¿ï¼ˆæœ€æ–°å®‰å®šç‰ˆï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    document.getElementById('uploadBtn').addEventListener('click', async () => {
      const status = document.getElementById('status');
      status.innerText = "ğŸ“¸ ç”»åƒã‚’ç”Ÿæˆä¸­â€¦";
      try {
        // ã‚­ãƒ£ãƒ—ãƒãƒ£å¯¾è±¡
        const wrap = document.getElementById('insc-wrap');
        // html2canvas ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const canvas = await html2canvas(wrap, { backgroundColor: null, scale: 2 });
        // Blob ã«å¤‰æ›
        canvas.toBlob(async blob => {
          // base64 æ–‡å­—åˆ—ã‚’ä½œæˆ
          const base64 = await new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.readAsDataURL(blob);
          });
          // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å–å¾—
          const username = document.getElementById("username").value.trim();
          const repo = document.getElementById("repo").value.trim();
          const token = document.getElementById("pat").value.trim();
          const filename = document.getElementById("filename").value.trim() || "inscription.png";
          if (!username || !repo || !token) {
            status.innerText = "âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒªãƒã‚¸ãƒˆãƒªåãƒ»PAT ã¯å¿…é ˆã§ã™ã€‚";
            return;
          }
          // GitHub API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
          const url = `https://api.github.com/repos/${username}/${repo}/contents/images/${filename}`;
          // PUT ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
          const res = await fetch(url, {
            method: 'PUT',
            headers: {
              "Authorization": `token ${token}`,
              "Accept": "application/vnd.github.v3+json"
            },
            body: JSON.stringify({
              message: "Add inscription image",
              content: base64
            })
          });
          if (res.ok) {
            const data = await res.json();
            status.innerHTML = `âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸï¼<br><a href="${data.content.html_url}" target="_blank">${data.content.path}</a>`;
          } else {
            const err = await res.json();
            status.innerText = `âŒ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ${res.status} ${err.message}`;
          }
        }, 'image/png');
      } catch (e) {
        status.innerText = `âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}`;
      }
    });
  </script>

</body>
</html>
